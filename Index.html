<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ConstructOS V1 (x64)</title>
    <style>
        :root {
            /* The 16-Color Palette */
            --c-black: #000000;
            --c-blue: #0000AA;
            --c-green: #00AA00;
            --c-cyan: #00AAAA;
            --c-red: #AA0000;
            --c-magenta: #AA00AA;
            --c-brown: #AA5500;
            --c-grey: #AAAAAA;
            --c-dgrey: #555555;
            --c-lblue: #5555FF;
            --c-lgreen: #55FF55;
            --c-lcyan: #55FFFF;
            --c-lred: #FF5555;
            --c-lmagenta: #FF55FF;
            --c-yellow: #FFFF55;
            --c-white: #FFFFFF;
        }

        body {
            background-color: var(--c-black);
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            color: var(--c-white);
            user-select: none;
            cursor: crosshair; /* The engineering cursor */
        }

        /* --- CRT Monitor Container --- */
        #monitor {
            width: 100vw;
            height: 100vh;
            background-color: var(--c-blue); /* The classic blue background */
            position: relative;
            box-sizing: border-box;
            border: 15px solid var(--c-dgrey);
        }

        /* --- Top Menu Bar --- */
        #menu-bar {
            background: var(--c-grey);
            color: var(--c-black);
            padding: 4px 10px;
            display: flex;
            gap: 25px;
            border-bottom: 4px double var(--c-black);
            font-size: 18px;
            z-index: 10000;
            position: relative;
            box-shadow: 0 4px 0 var(--c-black);
        }

        .menu-item { 
            cursor: pointer; 
            text-transform: uppercase;
        }
        .menu-item:hover { 
            background: var(--c-blue); 
            color: var(--c-white); 
        }

        /* --- Marquee / Status Bar --- */
        #status-bar {
            background: var(--c-cyan);
            color: var(--c-black);
            padding: 5px;
            font-size: 16px;
            border-bottom: 4px double var(--c-black);
            white-space: nowrap;
            overflow: hidden;
        }

        /* --- Windows --- */
        .window {
            position: absolute;
            background: var(--c-white);
            color: var(--c-black);
            border: 6px double var(--c-dgrey);
            box-shadow: 15px 15px 0px var(--c-black);
            display: flex;
            flex-direction: column;
            min-width: 300px;
            min-height: 200px;
            animation: pop 0.1s linear;
        }

        @keyframes pop { from { transform: scale(0.1); } to { transform: scale(1); } }

        .win-header {
            background: var(--c-blue);
            color: var(--c-white);
            padding: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 4px double var(--c-black);
            cursor: move;
            font-size: 18px;
        }

        .win-controls { display: flex; gap: 5px; }
        
        .btn-win {
            width: 20px; height: 20px;
            border: 2px solid var(--c-white);
            color: var(--c-white);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; font-size: 16px; font-weight: bold;
        }
        .btn-close { background: var(--c-red); }
        .btn-max { background: var(--c-green); }

        .win-content {
            flex: 1;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- App Specific Styles --- */
        
        /* Terminal */
        .term-body {
            background: var(--c-black);
            color: var(--c-lcyan);
            flex: 1;
            padding: 5px;
            font-size: 16px;
            overflow-y: auto;
            font-family: 'Courier New';
        }
        .term-input {
            background: transparent;
            border: none;
            color: var(--c-white);
            font-family: inherit;
            font-size: inherit;
            font-weight: bold;
            outline: none;
            width: 80%;
        }

        /* Browser */
        .nav-bar {
            display: flex;
            padding: 5px;
            background: var(--c-grey);
            border-bottom: 2px solid var(--c-black);
            gap: 5px;
        }
        .url-input {
            flex: 1;
            border: 2px solid var(--c-black);
            font-family: 'Courier New';
            font-weight: bold;
            padding: 2px;
        }
        .nav-btn {
            background: var(--c-dgrey);
            color: var(--c-white);
            border: 2px outset var(--c-white);
            cursor: pointer;
            font-weight: bold;
            font-family: 'Courier New';
        }
        .nav-btn:active { border-style: inset; }

        iframe { border: none; flex: 1; background: white; }

        /* Flight Sim Canvas */
        canvas { display: block; background: #000; image-rendering: pixelated; }

        /* Code Editor */
        textarea.code-area {
            flex: 1;
            background: var(--c-blue);
            color: var(--c-yellow);
            border: none;
            resize: none;
            padding: 10px;
            font-family: 'Courier New';
            font-weight: bold;
            font-size: 16px;
            outline: none;
        }

    </style>
</head>
<body>

    <div id="monitor">
        <!-- Top Menu -->
        <div id="menu-bar">
            <div class="menu-item" onclick="OS.open('term')">[Term]</div>
            <div class="menu-item" onclick="OS.open('browser')">[NetSurf]</div>
            <div class="menu-item" onclick="OS.open('code')">[Editor]</div>
            <div class="menu-item" onclick="OS.open('flight')">[Eagle]</div>
            <div class="menu-item" onclick="OS.open('calc')">[Calc]</div>
            <div style="flex:1;"></div>
            <div id="sys-clock">00:00:00</div>
        </div>

        <!-- Status Bar -->
        <div id="status-bar">
            SYSTEM READY || 64-BIT COMPILER OPTIMIZED || MEM: 640KB OK || NO GPU DETECTED - SOFTWARE RENDER ENGAGED
        </div>

        <!-- Desktop Container -->
        <div id="desktop"></div>
    </div>

    <script>
        // --- OS KERNEL ---
        const OS = {
            zIndex: 100,
            
            init: function() {
                this.updateClock();
                // Auto-open Terminal on boot
                setTimeout(() => this.open('term'), 500);
            },

            updateClock: function() {
                const now = new Date();
                document.getElementById('sys-clock').innerText = now.toLocaleTimeString();
                setTimeout(() => this.updateClock(), 1000);
            },

            open: function(appKey) {
                this.zIndex++;
                const id = 'win-' + Date.now();
                let title = 'Process';
                let w = '500px', h = '400px';
                let content = '';

                // Application Registry
                switch(appKey) {
                    case 'term':
                        title = 'Kernel Shell';
                        content = Apps.Terminal(id);
                        break;
                    case 'browser':
                        title = 'NetSurf Web Client';
                        w = '800px'; h = '500px';
                        content = Apps.Browser(id);
                        break;
                    case 'flight':
                        title = 'Eagle Flight Sim (Math)';
                        w = '640px'; h = '500px';
                        content = Apps.Flight(id);
                        break;
                    case 'code':
                        title = 'Source Editor';
                        content = Apps.Editor(id);
                        break;
                    case 'calc':
                        title = 'Math Unit';
                        w = '300px'; h = '400px';
                        content = Apps.Calc(id);
                        break;
                }

                this.createWindow(id, title, content, w, h);
                
                // Post-render initialization
                if(appKey === 'flight') setTimeout(() => Apps.initFlight(id), 50);
                if(appKey === 'term') setTimeout(() => document.getElementById(`in-${id}`).focus(), 50);
            },

            createWindow: function(id, title, contentHTML, width, height) {
                const win = document.createElement('div');
                win.className = 'window';
                win.id = id;
                win.style.width = width;
                win.style.height = height;
                win.style.zIndex = this.zIndex;
                
                // Random spawn position
                win.style.left = (40 + Math.random() * 100) + 'px';
                win.style.top = (60 + Math.random() * 100) + 'px';

                win.innerHTML = `
                    <div class="win-header" onmousedown="OS.dragStart(event, '${id}')">
                        <span>${title}</span>
                        <div class="win-controls">
                            <div class="btn-win btn-max" onclick="OS.maximize('${id}')">^</div>
                            <div class="btn-win btn-close" onclick="document.getElementById('${id}').remove()">X</div>
                        </div>
                    </div>
                    <div class="win-content">${contentHTML}</div>
                `;

                document.getElementById('desktop').appendChild(win);
                win.addEventListener('mousedown', () => win.style.zIndex = ++this.zIndex);
            },

            maximize: function(id) {
                const win = document.getElementById(id);
                if(win.style.width === '100%') {
                    // Restore
                    win.style.width = win.dataset.ow;
                    win.style.height = win.dataset.oh;
                    win.style.top = win.dataset.ot;
                    win.style.left = win.dataset.ol;
                } else {
                    // Maximize
                    win.dataset.ow = win.style.width;
                    win.dataset.oh = win.style.height;
                    win.dataset.ot = win.style.top;
                    win.dataset.ol = win.style.left;
                    win.style.width = '100%';
                    win.style.height = 'calc(100% - 40px)'; // Account for taskbar
                    win.style.top = '0';
                    win.style.left = '0';
                }
            },

            dragStart: function(e, id) {
                const win = document.getElementById(id);
                win.style.zIndex = ++this.zIndex;
                
                const shiftX = e.clientX - win.getBoundingClientRect().left;
                const shiftY = e.clientY - win.getBoundingClientRect().top;

                function moveAt(pageX, pageY) {
                    win.style.left = pageX - shiftX + 'px';
                    win.style.top = pageY - shiftY + 'px';
                }

                function onMouseMove(event) { moveAt(event.pageX, event.pageY); }

                document.addEventListener('mousemove', onMouseMove);
                document.onmouseup = function() {
                    document.removeEventListener('mousemove', onMouseMove);
                    document.onmouseup = null;
                };
            }
        };

        // --- APPLICATIONS ---
        const Apps = {
            Terminal: function(id) {
                return `
                    <div class="term-body" id="term-out-${id}" onclick="document.getElementById('in-${id}').focus()">
                        <div>ConstructOS Kernel v1.0</div>
                        <div>Copyright (c) 2024. No Warranty.</div>
                        <div>Type 'help' for commands.</div>
                        <br>
                        <div id="log-${id}"></div>
                        <div style="display:flex;">
                            <span>C:/ROOT/USER> </span>
                            <input type="text" id="in-${id}" class="term-input" autocomplete="off" onkeydown="Apps.handleCmd(event, '${id}')">
                        </div>
                    </div>
                `;
            },
            handleCmd: function(e, id) {
                if(e.key === 'Enter') {
                    const val = e.target.value;
                    const log = document.getElementById(`log-${id}`);
                    log.innerHTML += `<div>C:/ROOT/USER> ${val}</div>`;
                    
                    const cmd = val.toLowerCase().trim();
                    if(cmd === 'help') log.innerHTML += `<div style="color:var(--c-lgreen)">CMDS: DIR, CLS, TIME, ECHO, MOUNT, REBOOT</div>`;
                    else if(cmd === 'dir') log.innerHTML += `<div>KERNEL.BIN <br> GAMES/ <br> DOCS/ <br> CONFIG.SYS</div>`;
                    else if(cmd === 'cls') log.innerHTML = '';
                    else if(cmd === 'time') log.innerHTML += `<div>${new Date().toString()}</div>`;
                    else if(cmd === 'reboot') location.reload();
                    else log.innerHTML += `<div style="color:var(--c-lred)">Bad Command or File Name</div>`;

                    e.target.value = '';
                    document.getElementById(`term-out-${id}`).scrollTop = document.getElementById(`term-out-${id}`).scrollHeight;
                }
            },

            Browser: function(id) {
                // Default to a search engine that often allows framing, or Wikipedia
                return `
                    <div style="display:flex; flex-direction:column; height:100%;">
                        <div class="nav-bar">
                            <button class="nav-btn" onclick="Apps.nav('${id}', 'back')"><</button>
                            <button class="nav-btn" onclick="Apps.nav('${id}', 'reload')">R</button>
                            <input type="text" id="url-${id}" class="url-input" value="https://www.bing.com">
                            <button class="nav-btn" onclick="Apps.nav('${id}', 'go')">GO</button>
                            <button class="nav-btn" style="background:var(--c-lblue);" onclick="Apps.nav('${id}', 'pop')">↗</button>
                        </div>
                        <iframe id="frame-${id}" src="https://www.bing.com"></iframe>
                        <div style="background:var(--c-yellow); color:black; padding:2px; font-size:12px; text-align:center;">
                            NOTE: If site refuses to load, click [↗] to open external.
                        </div>
                    </div>
                `;
            },
            nav: function(id, action) {
                const frame = document.getElementById(`frame-${id}`);
                const input = document.getElementById(`url-${id}`);
                let url = input.value;

                if (!url.startsWith('http')) url = 'https://' + url;

                if (action === 'go') {
                    frame.src = url;
                } else if (action === 'back') {
                    frame.contentWindow.history.back();
                } else if (action === 'reload') {
                    frame.src = frame.src;
                } else if (action === 'pop') {
                    window.open(url, '_blank');
                }
            },

            Editor: function(id) {
                return `
                    <div style="display:flex; flex-direction:column; height:100%;">
                        <div style="background:#ddd; color:black; padding:2px;">FILE: UNTITLED.CPP</div>
                        <textarea class="code-area">
// System Startup Code
#include <kernel.h>

void main() {
    Print("System Initialized");
    int mem = GetFreeMem();
    if (mem > 640000) {
        LaunchShell();
    }
}</textarea>
                        <button class="nav-btn" style="width:100%;">COMPILE (F5)</button>
                    </div>
                `;
            },

            Calc: function(id) {
                return `
                    <div style="padding:10px; height:100%; background:var(--c-dgrey); display:flex; flex-direction:column; gap:5px;">
                        <input id="c-disp-${id}" type="text" style="width:100%; background:var(--c-lcyan); color:black; font-weight:bold; padding:5px; text-align:right;" readonly>
                        <div style="display:grid; grid-template-columns:repeat(4,1fr); gap:5px; flex:1;">
                            ${['7','8','9','/', '4','5','6','*', '1','2','3','-', 'C','0','=','+'].map(k => 
                                `<button onclick="Apps.calcBtn('${id}', '${k}')" style="font-weight:bold; font-family:'Courier New'; cursor:pointer;">${k}</button>`
                            ).join('')}
                        </div>
                    </div>
                `;
            },
            calcBtn: function(id, val) {
                const disp = document.getElementById(`c-disp-${id}`);
                if(val === 'C') disp.value = '';
                else if(val === '=') { try { disp.value = eval(disp.value); } catch{ disp.value='ERR'; } }
                else disp.value += val;
            },

            Flight: function(id) {
                return `<canvas id="cvs-${id}" width="600" height="400" style="width:100%; height:100%;"></canvas>`;
            },
            initFlight: function(id) {
                const canvas = document.getElementById(`cvs-${id}`);
                if(!canvas) return;
                const ctx = canvas.getContext('2d');
                let frame = 0;

                function draw() {
                    if(!document.getElementById(id)) return; // Stop loop if window closed
                    
                    // Simple Wireframe Renderer
                    ctx.fillStyle = "#000000";
                    ctx.fillRect(0,0, canvas.width, canvas.height);

                    const cx = canvas.width / 2;
                    const cy = canvas.height / 2;
                    
                    // Horizon
                    ctx.strokeStyle = "#FFFFFF";
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    let tilt = Math.sin(frame * 0.02) * 50;
                    ctx.moveTo(0, cy + tilt);
                    ctx.lineTo(canvas.width, cy - tilt);
                    ctx.stroke();

                    // Grid Ground
                    ctx.strokeStyle = "#00AAAA"; // Cyan
                    for(let i=0; i<12; i++) {
                        let y = cy + (i*i*2) + (frame % 20); // Moving forward effect
                        if (y > canvas.height) y = cy;
                        ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(canvas.width, y); ctx.stroke();
                    }
                    // Vertical lines
                    for(let i=-10; i<10; i++) {
                        ctx.beginPath();
                        ctx.moveTo(cx + (i*50) + (tilt*2), cy);
                        ctx.lineTo(cx + (i*200), canvas.height);
                        ctx.stroke();
                    }

                    // Floating Objects (Abstract 3D)
                    ctx.strokeStyle = "#AA0000"; // Red
                    let size = 50 + Math.sin(frame * 0.05) * 20;
                    let ox = cx + Math.cos(frame * 0.03) * 100;
                    let oy = cy - 50 + Math.sin(frame * 0.03) * 50;
                    
                    ctx.strokeRect(ox - size/2, oy - size/2, size, size);
                    ctx.beginPath(); ctx.moveTo(ox, oy); ctx.lineTo(ox+size/2, oy+size/2); ctx.stroke();

                    // HUD
                    ctx.fillStyle = "#FFFF55";
                    ctx.font = "20px Courier New";
                    ctx.fillText(`ALT: ${1000 + Math.floor(Math.sin(frame*0.1)*50)} FT`, 10, 30);
                    ctx.fillText(`VEL: 450 KNOTS`, 10, 50);

                    frame++;
                    requestAnimationFrame(draw);
                }
                draw();
            }
        };

        // Start
        OS.init();
    </script>
</body>
</html>
